function [u]=AOM(q1, q2, q3, q1d, q2d, q3d, q1p, q2p, q3p, q1pp, q2pp, q3pp, t, epop)


m2=0.072;
m3=0.068;
l1=0.12;
l2=0.13;
l3=0.09;
g3=9.81;
Kp=eye(3)*100;
Kd=eye(3)*10;


q=[q1; q2; q3];
qp=[q1p; q2p; q3p];
qpp=[q1pp; q2pp; q3pp];
Mq= [(3265481663888969*cos(2*q2))/18446744073709551616 - (8205946264988645*sin(2*q2 + 2*q3))/18446744073709551616 - (263674806892459*cos(2*q2 + 2*q3))/576460752303423488 - (4184215030302065*sin(2*q2))/9223372036854775808 - (2549109446685739*l2*sin(q3))/1152921504606846976 - (2549109446685739*l3*sin(2*q2 + 2*q3))/1152921504606846976 + (67*l3^2*cos(2*q2 + 2*q3))/2000 - (2549109446685739*l2*sin(2*q2 + q3))/1152921504606846976 + (139*l2^2)/2000 + (67*l3^2)/2000 + (139*l2^2*cos(2*q2))/2000 + (67*l2*l3*cos(2*q2 + q3))/1000 + (67*l2*l3*cos(q3))/1000 + 105346555895530687/18446744073709551616, (2838835145611323*sin(q2))/9223372036854775808 - (3117807916074061*cos(q2))/9223372036854775808 - (1266753801116703*cos(q2 + q3))/2305843009213693952 + (6310642948597741*sin(q2 + q3))/4611686018427387904 - (1073009632818785*l2*sin(q2))/72057594037927936 - (3109141067548515*l3*sin(q2 + q3))/288230376151711744,            (6310642948597741*sin(q2 + q3))/4611686018427387904 - (1266753801116703*cos(q2 + q3))/2305843009213693952 - (3109141067548515*l3*sin(q2 + q3))/288230376151711744;
                                                                                                                                                                                                                                                                                                           (2838835145611323*sin(q2))/9223372036854775808 - (6310084434083227*cos(q2))/18446744073709551616 - (1266753801116703*cos(q2 + q3))/2305843009213693952 + (6310642948597741*sin(q2 + q3))/4611686018427387904 - (1073009632818785*l2*sin(q2))/72057594037927936 - (3109141067548515*l3*sin(q2 + q3))/288230376151711744,                                                                                                                                                                                       (139*l2^2)/1000 + (67*cos(q3)*l2*l3)/500 - (2549109446685739*sin(q3)*l2)/576460752303423488 + (67*l3^2)/1000 + 59662946945316923/9223372036854775808, (67*l3^2)/1000 + (67*l2*cos(q3)*l3)/1000 - (4403007226093549*l2*cos(q3))/576460752303423488 - (2549109446685739*l2*sin(q3))/1152921504606846976 + 2704266616648197/576460752303423488;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (6310642948597741*sin(q2 + q3))/4611686018427387904 - (1266753801116703*cos(q2 + q3))/2305843009213693952 - (3109141067548515*l3*sin(q2 + q3))/288230376151711744,                                                                                                                                                   (67*l3^2)/1000 + (67*l2*cos(q3)*l3)/1000 + (4403007226093549*l2*cos(q3))/576460752303423488 - (2549109446685739*l2*sin(q3))/1152921504606846976 + 2704266616648197/576460752303423488,                                                                                                                                           (67*l3^2)/1000 + 2704266616648197/576460752303423488]

Cqq= [- q2p*((139*sin(2*q2)*l2^2)/2000 + (67*sin(2*q2 + q3)*l2*l3)/1000 + (2549109446685739*cos(2*q2 + q3)*l2)/1152921504606846976 + (67*sin(2*q2 + 2*q3)*l3^2)/2000 + (2549109446685739*cos(2*q2 + 2*q3)*l3)/1152921504606846976 + (8205946264988645*cos(2*q2 + 2*q3))/18446744073709551616 - (263674806892459*sin(2*q2 + 2*q3))/576460752303423488 + (4184215030302065*cos(2*q2))/9223372036854775808 + (3265481663888969*sin(2*q2))/18446744073709551616) - q3p*((8205946264988645*cos(2*q2 + 2*q3))/18446744073709551616 - (263674806892459*sin(2*q2 + 2*q3))/576460752303423488 + (2549109446685739*l2*cos(q3))/2305843009213693952 + (2549109446685739*l3*cos(2*q2 + 2*q3))/1152921504606846976 + (67*l3^2*sin(2*q2 + 2*q3))/2000 + (2549109446685739*l2*cos(2*q2 + q3))/2305843009213693952 + (67*l2*l3*sin(2*q2 + q3))/2000 + (67*l2*l3*sin(q3))/2000), q3p*((6310642948597741*cos(q2 + q3))/4611686018427387904 + (1266753801116703*sin(q2 + q3))/2305843009213693952 - (3109141067548515*l3*cos(q2 + q3))/288230376151711744) - q1p*((139*sin(2*q2)*l2^2)/2000 + (67*sin(2*q2 + q3)*l2*l3)/1000 + (2549109446685739*cos(2*q2 + q3)*l2)/1152921504606846976 + (67*sin(2*q2 + 2*q3)*l3^2)/2000 + (2549109446685739*cos(2*q2 + 2*q3)*l3)/1152921504606846976 + (8205946264988645*cos(2*q2 + 2*q3))/18446744073709551616 - (263674806892459*sin(2*q2 + 2*q3))/576460752303423488 + (4184215030302065*cos(2*q2))/9223372036854775808 + (3265481663888969*sin(2*q2))/18446744073709551616) + q2p*((2838835145611323*cos(q2))/18446744073709551616 + (3117807916074061*sin(q2))/18446744073709551616 + (6310642948597741*cos(q2 + q3))/9223372036854775808 + (1266753801116703*sin(q2 + q3))/4611686018427387904 - (1073009632818785*l2*cos(q2))/144115188075855872 - (3109141067548515*l3*cos(q2 + q3))/576460752303423488), q2p*((6310642948597741*cos(q2 + q3))/4611686018427387904 + (1266753801116703*sin(q2 + q3))/2305843009213693952 - (3109141067548515*l3*cos(q2 + q3))/288230376151711744) + q3p*((6310642948597741*cos(q2 + q3))/4611686018427387904 + (1266753801116703*sin(q2 + q3))/2305843009213693952 - (3109141067548515*l3*cos(q2 + q3))/288230376151711744) - q1p*((8205946264988645*cos(2*q2 + 2*q3))/18446744073709551616 - (263674806892459*sin(2*q2 + 2*q3))/576460752303423488 + (2549109446685739*l2*cos(q3))/2305843009213693952 + (2549109446685739*l3*cos(2*q2 + 2*q3))/1152921504606846976 + (67*l3^2*sin(2*q2 + 2*q3))/2000 + (2549109446685739*l2*cos(2*q2 + q3))/2305843009213693952 + (67*l2*l3*sin(2*q2 + q3))/2000 + (67*l2*l3*sin(q3))/2000);
                                                                                                                                                                                                                                                                                                                                                                                       q1p*((139*sin(2*q2)*l2^2)/2000 + (67*sin(2*q2 + q3)*l2*l3)/1000 + (2549109446685739*cos(2*q2 + q3)*l2)/1152921504606846976 + (67*sin(2*q2 + 2*q3)*l3^2)/2000 + (2549109446685739*cos(2*q2 + 2*q3)*l3)/1152921504606846976 + (8205946264988645*cos(2*q2 + 2*q3))/18446744073709551616 - (263674806892459*sin(2*q2 + 2*q3))/576460752303423488 + (4184215030302065*cos(2*q2))/9223372036854775808 + (3265481663888969*sin(2*q2))/18446744073709551616) + (74468601935105*sin(q2)*q2p)/36893488147419103232,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -q3p*((2549109446685739*l2*cos(q3))/1152921504606846976 + (67*l2*l3*sin(q3))/1000),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - q2p*((2549109446685739*l2*cos(q3))/1152921504606846976 + (67*l2*l3*sin(q3))/1000) - (l2*q3p*(318638680835717375*cos(q3) - 1100751806523387250*sin(q3) + 9655717601082343424*l3*sin(q3)))/144115188075855872000;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 q1p*((8205946264988645*cos(2*q2 + 2*q3))/18446744073709551616 - (263674806892459*sin(2*q2 + 2*q3))/576460752303423488 + (2549109446685739*l2*cos(q3))/2305843009213693952 + (2549109446685739*l3*cos(2*q2 + 2*q3))/1152921504606846976 + (67*l3^2*sin(2*q2 + 2*q3))/2000 + (2549109446685739*l2*cos(2*q2 + q3))/2305843009213693952 + (67*l2*l3*sin(2*q2 + q3))/2000 + (67*l2*l3*sin(q3))/2000),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    q2p*((2549109446685739*l2*cos(q3))/1152921504606846976 + (67*l2*l3*sin(q3))/1000) - (4403007226093549*l2*sin(q3)*q3p)/576460752303423488,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0]
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
D =[         0;
- g3*m3*(l2*cos(q2) + l3*cos(q2 + q3)) - g3*l2*m2*cos(q2);
               -g3*l3*m3*cos(q2 + q3) ];                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
qd=[q1d;q2d;q3d];
e= q-qd;
d=Kd*(e-epop)/t;
p=Kp*e;
epop=e;

u=Mq*qpp+Cqq*qp+D-Mq*d-Mq*p;
end


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       